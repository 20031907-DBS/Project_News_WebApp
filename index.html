<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project_News_WEBAPP</title>
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
<!--    <div id="container"></div>
    <script>
      async function fetchadd() {
        try {
          const fetchArticle = await fetch("http://localhost:8080/articles");
          const dataParsed = await fetchArticle.json();
          const container = document.getElementById("container");
          dataParsed.forEach((element) => {
            const head = document.createElement("div");
            const headline = document.createElement("h2");
            headline.textContent = element.title;
            const description = document.createElement("p");
            description.textContent = element.description;
            const link = document.createElement("a");
            link.href = element.url;
            link.textContent = "Read More";
            link.target = "_blank";
            const pubdate = document.createElement("p");
            pubdate.textContent = element.publishedAt;
            const source = document.createElement("p");
            source.textContent = element.source;

            head.appendChild(headline);
            head.appendChild(description);
            head.appendChild(pubdate);
            head.appendChild(source);
            container.appendChild(head);
          });
        } catch (err) {
          console.log(`E`, err);
        }
      }
      fetchadd();
    </script>
    -->
    <div id="app" class="app">
      <div class="sidebar-container" id="sidebar"></div>
    </div>
  <script>
    const sidebar = document.querySelector('#sidebar');
    const CATEGORIES = ['general', 'business', 'sports', 'entertainment', 'science', 'health', 'technology'];
    function initializeUI() {
    CATEGORIES.forEach(category => {
    const button = document.createElement('button');
    button.textContent = category;
    sidebar.appendChild(button);
  });
}

let posts = [];
let page = 1;
let loading = false;
let activeCategory = 'general';

 
async function fetchNews() {
  if (loading) return;   
  loading = true;

  try {
    const category = activeCategory.toLowerCase();
    const response = await fetch(`http://localhost:5000/api/news?page=${page}&category=${category === 'general' ? '' : category}`);
    const data = await response.json();

    
    if (data.articles) {
      data.articles.forEach(article => {
        posts.push({
          title: article.title,
          description: article.description,
          url: article.url,
          imageUrl: article.urlToImage ? `${article.urlToImage}?w=400&h=200&fit=crop` : null
        });
      });
      renderPosts();  
      page++;  
    }
  } catch (error) {
    console.error('Error fetching news:', error);
  } finally {
    loading = false;   
  }
}

function generatePostHTML(post) {
  return `
    <div class="content-block">
      <h3>${post.title}</h3>
      <p>${post.description}</p>
      ${post.imageUrl ? `<img src="${post.imageUrl}" alt="${post.title}">` : ''}
      <a href="${post.url}" target="_blank" rel="noopener noreferrer">Read More</a>
    </div>
  `;
}

function getLoadingStateMessage(loading, posts) {
  if (loading && posts.length === 0) {
    return '<p>Loading...</p>';
  }
  return loading ? '<p>Loading more posts...</p>' : '';
}


function renderPosts() {
  const loadingMessage = getLoadingStateMessage(loading, posts);
  const postsHTML = posts.map(generatePostHTML).join('');
  content.innerHTML = postsHTML + loadingMessage;
}



initializeUI(); 
fetchNews();
  </script>
  </body>
</html>
